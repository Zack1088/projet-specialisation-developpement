import"./style-BpaiFPrc.js";const c="http://localhost:5000/api";let r="",i=null;async function m(){r=(await(await fetch(`${c}/csrf-token`,{credentials:"include"})).json()).csrfToken}async function p(){try{const e=await fetch(`${c}/auth/me`,{credentials:"include"});if(!e.ok)throw new Error("Non connecté");const{id:t}=await e.json(),n=await fetch(`${c}/auth/profile/${t}`,{credentials:"include"});if(!n.ok)throw new Error("Profil introuvable");return i=await n.json(),console.log("👤 Utilisateur connecté :",i),i}catch{return window.location.href="/login.html",null}}function f(){const e=document.getElementById("welcomeUser"),t=document.getElementById("goShopBtn");if(i){const n=i.username||i.name||"Utilisateur";e.textContent=`Bienvenue, ${n} 👋`,t==null||t.classList.remove("hidden")}else e.textContent="",t==null||t.classList.add("hidden")}function a(){return fetch(`${c}/products`,{credentials:"include"}).then(e=>e.json()).then(h).catch(e=>console.error("Erreur chargement produits :",e))}function h(e){const t=document.getElementById("productList");t&&(t.innerHTML="",e.forEach(n=>{const o=document.createElement("div");o.className="bg-white p-4 rounded shadow",o.innerHTML=`
      <h3 class="text-lg font-bold">${n.name}</h3>
      <p>${n.description}</p>
      <p class="font-semibold text-blue-600">${n.price} €</p>
      <p class="text-sm text-gray-600">${n.category}</p>
      <div class="mt-2 space-x-2">
        <button data-id="${n.id}" class="edit bg-yellow-400 text-white px-2 py-1 rounded">Modifier</button>
        <button data-id="${n.id}" class="delete bg-red-500 text-white px-2 py-1 rounded">Supprimer</button>
      </div>
    `,t.appendChild(o)}))}const d=document.getElementById("productForm");d&&d.addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("productId").value,n={name:document.getElementById("name").value,description:document.getElementById("description").value,price:parseFloat(document.getElementById("price").value),category:document.getElementById("category").value,images:[]},o=t?"PUT":"POST",u=t?`${c}/products/${t}`:`${c}/products`;(await fetch(u,{method:o,credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":r},body:JSON.stringify(n)})).ok?(e.target.reset(),document.getElementById("productId").value="",await a()):alert("❌ Erreur lors de l'enregistrement")});const s=document.getElementById("productList");s&&s.addEventListener("click",async function(e){const t=e.target.getAttribute("data-id");if(t){if(e.target.classList.contains("edit")){const o=await(await fetch(`${c}/products/${t}`,{credentials:"include"})).json();document.getElementById("productId").value=o.id,document.getElementById("name").value=o.name,document.getElementById("description").value=o.description,document.getElementById("price").value=o.price,document.getElementById("category").value=o.category}e.target.classList.contains("delete")&&confirm("Confirmer la suppression ?")&&((await fetch(`${c}/products/${t}`,{method:"DELETE",credentials:"include",headers:{"X-CSRF-Token":r}})).ok?await a():alert("❌ Suppression échouée"))}});var l;(l=document.getElementById("logoutBtn"))==null||l.addEventListener("click",async()=>{await fetch(`${c}/auth/logout`,{method:"GET",credentials:"include",headers:{"X-CSRF-Token":r}}),window.location.href="/"});(async function(){await m(),i=await p(),i&&(f(),await a())})();
